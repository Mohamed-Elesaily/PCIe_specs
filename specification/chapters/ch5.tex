\chapter{Scenarios}
\section{TX Scenarios}
\subsection{Sending TLP or DLLP}
\begin{enumerate}
\item Data (TLP or DLLP) comes from Data Link Layer and is stored in the FIFO.
\item In GEN 1\&2 FIFO Appends STP (in case of TLP), SDP (in case of DLLP) and END Symbols to TLP or DLLP and sends to Mux data, data valid and d/k signal .
\item In Gen 3\&4\&5 FIFO Appends STP token (in case of TLP), SDP token (in case of DLLP) and EDS token. 
\item In GEN 3\&4\&5, if there is an order set (except skip order set) after data stream, FIFO should append EDS token. 
\item Tx LTSSM states that we are in L0 state.
\item Tx LTSSM informs the MUX to take the output coming from the FIFO.
\item Tx LTSSSM informs the Lane Management Control that data coming from the output of MUX is TLP or DLLP.
\item Data is scrambled using scrambler.
\item In GEN 1\&2 Pipe Tx Data outputs the data and assert data valid \& datak. 
\item In GEN 3\&4\&5, Pipe Tx Data outputs the data and assert data valid and adds sync header and start of block before sending data to the PIPE interface.
\end{enumerate}
\subsection{Sending Ordered Sets}
\begin{enumerate}
  \item Tx LTSSM based on current state will send to os generator the Type of order set it needs to send, OS fields, and count of how many times it will send it.
  \item Tx LTSSM sends to FIFO to hold the data inside it.
  \item Tx LTSSM informs the MUX to take the OS generator output.
  \item Tx LTSSM informs Lane Management Control that data coming from the output of MUX is order set.
  \item Link management control should distribute the OS on all lanes as per spec.
  \item All order sets bypass scrambling except for symbols from 1 to 15 for TS order sets in GEN 3\&4\&5.
  \item In GEN 1\&2, Pipe Tx Data outputs the OS and assert data valid \& datak. 
  \item In GEN 3\&4\&5, Pipe Tx Data outputs the OS and assert data valid and adds sync header and start of block before sending OS to the PIPE interface. 
\end{enumerate}

\section{RX Scenario}
\subsection{Receiving TLP or DLLP}
\begin{enumerate}
  \item PIPE Rx data checks data valid is asserted or not.
  \item For GEN 3\&4\&5, PIPE Rx data checks for the sync header to know whether packet received is data (TLP or DLLP) or order set.
  \item Descrambles the data using descrambler.
  \item Link control management un-stripes data bytes.
  \item In GEN 1\&2 Packet identifier will take the output of the link management Control and will remove STP (in case of TLP), SDP (in case of DLLP) and END and set sop and eop.
  \item In GEN 3\&4\&5 Packet identifier will take the output of the link management Control and will remove STP token (in case of TLP), SDP token (in case of DLLP) 
  \item In GEN 3\&4\&5, in case of DLLP after removing SDP token we will forward the next 6 symbols to the FIFO.
  \item In GEN 3\&4\&5, in case of TLP after removing STP token we will forward the next (length â€“ 1) x 4 symbols to the FIFO.
  \item FIFO forwards data to datalink layer.
\end{enumerate}
\subsection{Receiving Ordered Sets}
\begin{enumerate}
  \item Order set come on all lanes simultaneously.
  \item PIPE Rx data checks data valid is asserted or not.
  \item For GEN 3\&4\&5, PIPE Rx data checks for the sync header to know whether packet received is data (TLP or DLLP) or order set.
  \item All order sets bypass descrambling except for symbols from 1 to 15 for TS order sets in GEN 3\&4\&5.
  \item Link control management un-stripes data bytes.
  \item OS Decoder will decode the order set and give its information to Rx LTSSM
\end{enumerate}

